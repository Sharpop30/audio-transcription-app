<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תמלול אודיו - OpenAI Whisper</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* עיצוב חדש לכותרת */
        .title-container {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .main-title {
            color: #ff6b00;
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(255,107,0,0.2);
        }
        
        .main-title i {
            color: #4a4a4a;
            margin-left: 15px;
            font-size: 3.5rem;
            animation: microphone-pulse 2s ease-in-out infinite;
        }
        
        .subtitle {
            color: #ff8533;
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .copyright {
            color: #ff9966;
            font-size: 1rem;
            font-weight: 400;
            margin-top: 1.5rem;
        }
        
        .api-key-section {
            background: linear-gradient(to right, #f8f9fa, #ffffff);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .api-key-title {
            color: #2575fc;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        
        .api-key-title i {
            margin-left: 0.5rem;
            font-size: 1.2rem;
        }
        
        .api-key-input {
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .api-key-input:focus {
            border-color: #2575fc;
            box-shadow: 0 0 0 0.2rem rgba(37, 117, 252, 0.25);
        }
        
        .api-key-button {
            background: linear-gradient(120deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .api-key-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(37, 117, 252, 0.3);
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            background-color: white;
        }

        .card-title {
            color: #4a5568;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }

        .form-label {
            color: #4a5568;
            font-weight: 500;
        }

        .form-control {
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #6b21a8;
            box-shadow: 0 0 0 0.2rem rgba(107, 33, 168, 0.25);
        }

        .btn-primary {
            background-color: #6b21a8;
            border: none;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #5b1696;
            transform: translateY(-2px);
        }

        #dropZone {
            border: 2px dashed #e2e8f0;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #dropZone:hover {
            border-color: #6b21a8;
            background-color: #f8f9fa;
        }

        #dropZone.dragover {
            border-color: #6b21a8;
            background-color: #f8f9fa;
        }

        .progress {
            height: 0.5rem;
            border-radius: 1rem;
            margin: 1rem 0;
        }

        .alert {
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .btn-copy, .btn-download {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-copy:hover, .btn-download:hover {
            transform: translateY(-2px);
        }

        .history-item {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .history-timestamp {
            color: #718096;
            font-size: 0.9rem;
        }

        .history-preview {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .history-full {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .btn-expand {
            font-size: 0.9rem;
            color: #2575fc;
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .btn-expand:hover {
            color: #1a56db;
            text-decoration: underline;
        }
        
        .language-select {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .language-select select {
            width: 100%;
            padding: 0.5rem;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-size: 1rem;
            direction: rtl;
        }

        .language-select select:focus {
            border-color: #ff6b00;
            box-shadow: 0 0 0 0.2rem rgba(255,107,0,0.25);
            outline: none;
        }

        .language-select label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-weight: 600;
        }
        
        @keyframes microphone-pulse {
            0% {
                transform: scale(1);
                text-shadow: 0 0 10px rgba(74, 74, 74, 0.5);
            }
            50% {
                transform: scale(1.1);
                text-shadow: 0 0 20px rgba(74, 74, 74, 0.5);
            }
            100% {
                transform: scale(1);
                text-shadow: 0 0 10px rgba(74, 74, 74, 0.5);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title-container">
            <h1 class="main-title">
                <i class="fas fa-microphone-alt"></i>
                תמלול קולי חכם
            </h1>
            <p class="subtitle">הפיכת הקלטות לטקסט בעזרת בינה מלאכותית מתקדמת</p>
            <p class="copyright">© כל הזכויות שמורות לסהר פורר</p>
        </div>
        
        <!-- הסבר על API Key -->
        <div class="alert alert-info mb-4" role="alert">
            <h5 class="alert-heading"><i class="fas fa-info-circle me-2"></i>איך מקבלים מפתח API?</h5>
            <ol class="mb-0">
                <li>נכנסים לאתר <a href="https://platform.openai.com/signup" target="_blank">OpenAI</a> ונרשמים</li>
                <li>עוברים לדף <a href="https://platform.openai.com/api-keys" target="_blank">יצירת מפתחות</a></li>
                <li>לוחצים על "Create new secret key" ומעתיקים את המפתח</li>
                <li>מדביקים את המפתח בתיבת הטקסט למטה</li>
            </ol>
            <hr>
            <p class="mb-0"><strong>שימו לב:</strong> המפתח נשמר אך ורק במחשב שלכם ולא נשלח לשום שרת חיצוני</p>
        </div>

        <!-- API Key Section -->
        <div class="api-key-section">
            <h5 class="api-key-title">
                <i class="fas fa-key"></i>
                הגדרת מפתח API
            </h5>
            <div class="mb-3">
                <label for="apiKey" class="form-label">OpenAI API Key</label>
                <div class="input-group">
                    <input type="password" class="form-control api-key-input" id="apiKey" placeholder="הזן את מפתח ה-API שלך">
                    <button class="btn btn-outline-secondary" type="button" onclick="toggleApiKeyVisibility()">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            <button class="api-key-button" onclick="saveApiKey()">
                <i class="fas fa-save me-2"></i>
                שמור מפתח API
            </button>
            <div id="apiKeyStatus" class="mt-2"></div>
        </div>

        <!-- Audio Upload Section -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">העלאת קובץ אודיו</h5>
                <div class="alert alert-info mb-3">
                    <h6 class="alert-heading mb-2"><i class="fas fa-info-circle me-2"></i>פורמטים נתמכים:</h6>
                    <ul class="mb-0">
                        <li>קבצי MP3 (*.mp3)</li>
                        <li>קבצי WAV (*.wav)</li>
                        <li>קבצי M4A (*.m4a)</li>
                        <li>קבצי MP4 (*.mp4)</li>
                        <li>קבצי MPEG (*.mpeg)</li>
                        <li>קבצי WEBM (*.webm)</li>
                    </ul>
                    <hr>
                    <p class="mb-0"><strong>הערה:</strong> גודל הקובץ המקסימלי הוא 25MB</p>
                </div>
                <div class="language-select">
                    <label for="targetLanguage"><i class="fas fa-language me-2"></i>בחר שפת יעד לתמלול:</label>
                    <select id="targetLanguage" class="form-select">
                        <option value="he">עברית</option>
                        <option value="ar">ערבית</option>
                        <option value="en">אנגלית</option>
                        <option value="zh">סינית</option>
                        <option value="ru">רוסית</option>
                        <option value="tr">תורכית</option>
                        <option value="ja">יפנית</option>
                    </select>
                </div>
                <div id="dropZone" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" onclick="document.getElementById('audioFile').click()">
                    <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                    <p>גרור קובץ אודיו לכאן או לחץ לבחירת קובץ</p>
                    <input type="file" id="audioFile" accept="audio/*,.mp3,.wav,.m4a,.mp4,.mpeg,.webm" style="display: none;" onchange="handleAudioFile()">
                </div>
                <div id="progressStatus" class="mt-3" style="display: none;">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                    </div>
                    <p class="text-center mt-2" id="processingMessage"></p>
                    <p class="text-center" id="processingTime"></p>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="card" id="resultCard" style="display: none;">
            <div class="card-body">
                <h5 class="card-title">תוצאות התמלול</h5>
                <div class="mb-3">
                    <p id="transcriptionText" style="white-space: pre-wrap;"></p>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <button class="btn btn-outline-primary btn-copy me-2" onclick="copyTranscription(this)">
                            <i class="fas fa-copy me-1"></i>
                            העתק
                        </button>
                        <button class="btn btn-outline-primary btn-download" onclick="downloadTranscription(this)">
                            <i class="fas fa-download me-1"></i>
                            הורד
                        </button>
                    </div>
                    <small class="text-muted" id="timestamp"></small>
                </div>
            </div>
        </div>

        <!-- הסבר על היסטוריה -->
        <div class="alert alert-info mb-4" role="alert">
            <h5 class="alert-heading"><i class="fas fa-history me-2"></i>היסטוריית תמלולים</h5>
            <p class="mb-0">היסטוריית תמלולים מכילה עשרה תמלולים אחרונים השמורים במחשב שלכם בלבד.</p>
        </div>

        <!-- History Section -->
        <div class="card mb-4" id="historyCard" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0">היסטוריית תמלולים</h5>
            </div>
            <div class="card-body">
                <div id="historyList" class="list-group"></div>
            </div>
        </div>
    </div>

    <script>
        function toggleApiKeyVisibility() {
            const apiKeyInput = document.getElementById('apiKey');
            const toggleButton = apiKeyInput.nextElementSibling;
            if (apiKeyInput.type === 'password') {
                apiKeyInput.type = 'text';
                toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                apiKeyInput.type = 'password';
                toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        function showApiKeyStatus(message, type) {
            const statusDiv = document.getElementById('apiKeyStatus');
            statusDiv.className = `alert alert-${type}`;
            statusDiv.textContent = message;
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (apiKey) {
                localStorage.setItem('openai_api_key', apiKey);
                showApiKeyStatus('מפתח API נשמר בהצלחה!', 'success');
            } else {
                showApiKeyStatus('אנא הכנס מפתח API', 'danger');
            }
        }

        let processingStartTime;

        function updateProcessingTime() {
            if (processingStartTime) {
                const currentTime = new Date();
                const elapsedSeconds = Math.floor((currentTime - processingStartTime) / 1000);
                const timeElement = document.getElementById('processingTime');
                timeElement.textContent = `זמן עיבוד: ${elapsedSeconds} שניות`;
            }
        }

        function showError(message) {
            const progressStatus = document.getElementById('progressStatus');
            progressStatus.innerHTML = `<div class="alert alert-danger">${message}</div>`;
            progressStatus.style.display = 'block';
        }

        function showProgress(message) {
            const progressStatus = document.getElementById('progressStatus');
            const processingMessage = document.getElementById('processingMessage');
            processingMessage.textContent = message;
            progressStatus.style.display = 'block';
            processingStartTime = new Date();
            setInterval(updateProcessingTime, 1000);
        }

        function displayTranscription(text, timestamp = new Date().toISOString()) {
            const resultCard = document.getElementById('resultCard');
            const transcriptionText = document.getElementById('transcriptionText');
            const timestampElement = document.getElementById('timestamp');
            
            transcriptionText.textContent = text;
            timestampElement.textContent = new Date(timestamp).toLocaleString('he-IL');
            resultCard.style.display = 'block';
            
            addToHistory(text, timestamp);
        }

        async function handleAudioFile() {
            const fileInput = document.getElementById('audioFile');
            const file = fileInput.files[0];
            const apiKey = localStorage.getItem('openai_api_key');
            const targetLanguage = document.getElementById('targetLanguage').value;
            
            if (!apiKey) {
                showError('נא להזין מפתח API תקין');
                return;
            }
            
            if (!file) {
                showError('נא לבחור קובץ אודיו');
                return;
            }

            showProgress('מעבד את קובץ האודיו...');
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('model', 'whisper-1');
            formData.append('language', targetLanguage);
            formData.append('response_format', 'json');

            try {
                const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`שגיאה בתמלול: ${response.status}`);
                }

                const data = await response.json();
                document.getElementById('progressStatus').style.display = 'none';
                displayTranscription(data.text);
            } catch (error) {
                showError(error.message);
            }
        }

        function copyTranscription(button) {
            const text = document.getElementById('transcriptionText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check me-1"></i>הועתק';
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            });
        }

        function downloadTranscription(button) {
            const text = document.getElementById('transcriptionText').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transcription_${new Date().toISOString()}.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check me-1"></i>הורד';
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);
        }

        function addToHistory(text, timestamp) {
            const history = JSON.parse(localStorage.getItem('transcriptionHistory') || '[]');
            
            history.unshift({
                text: text,
                timestamp: timestamp
            });
            
            if (history.length > 10) {
                history.pop();
            }
            
            localStorage.setItem('transcriptionHistory', JSON.stringify(history));
            displayHistory();
        }

        function displayHistory() {
            const historyList = document.getElementById('historyList');
            const history = JSON.parse(localStorage.getItem('transcriptionHistory') || '[]');
            
            if (history.length > 0) {
                document.getElementById('historyCard').style.display = 'block';
                historyList.innerHTML = history.map((item, index) => {
                    const preview = item.text.length > 200 ? item.text.substring(0, 200) + '...' : item.text;
                    return `
                        <div class="list-group-item history-item">
                            <div class="d-flex w-100 justify-content-between mb-2">
                                <small class="history-timestamp">${new Date(item.timestamp).toLocaleString('he-IL')}</small>
                            </div>
                            <div class="history-preview">${preview}</div>
                            ${item.text.length > 200 ? `
                                <button class="btn-expand" onclick="toggleHistoryItem(${index})">
                                    <i class="fas fa-chevron-down me-1"></i>קרא עוד
                                </button>
                                <div class="history-full" id="history-full-${index}">
                                    ${item.text}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            } else {
                document.getElementById('historyCard').style.display = 'none';
            }
        }

        function toggleHistoryItem(index) {
            const fullText = document.getElementById(`history-full-${index}`);
            const button = fullText.previousElementSibling;
            
            if (fullText.style.display === 'none' || !fullText.style.display) {
                fullText.style.display = 'block';
                button.innerHTML = '<i class="fas fa-chevron-up me-1"></i>הסתר';
            } else {
                fullText.style.display = 'none';
                button.innerHTML = '<i class="fas fa-chevron-down me-1"></i>קרא עוד';
            }
        }

        function dragOverHandler(event) {
            event.preventDefault();
            event.stopPropagation();
            event.target.classList.add('dragover');
        }

        function dropHandler(event) {
            event.preventDefault();
            event.stopPropagation();
            event.target.classList.remove('dragover');
            
            const file = event.dataTransfer.files[0];
            if (file && file.type.startsWith('audio/')) {
                const fileInput = document.getElementById('audioFile');
                fileInput.files = event.dataTransfer.files;
                handleAudioFile();
            }
        }

        window.onload = function() {
            const storedKey = localStorage.getItem('openai_api_key');
            if (storedKey) {
                document.getElementById('apiKey').value = storedKey;
                showApiKeyStatus('מפתח API נטען בהצלחה!', 'success');
            }
            displayHistory();
        }
    </script>
</body>
</html>
